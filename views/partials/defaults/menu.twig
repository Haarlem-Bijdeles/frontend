{% import 'partials/defaults/image.twig' as image %}

{% if menu.get_items %}
  <nav aria-label="{{label}}" class="{{selector}}{%if js_class %} {{js_class}}{% endif %}"{% if id %} id="{{ id }}"{% endif %}>

    <div class="menu__bg"></div>

    <ul class="{{selector}}__list">
      {% for item in menu.get_items %}
        <li class="{{selector}}__item">
          <a class="{{selector}}__link {{item.classes | join(' ')}}"  href="{{ item.link }}" title="{{ item.title }}"{% if item.target %} target="{{ item.target }}"{% endif %}>{{ item.title }}</a>
          {% if item.children %}
            {% include 'partials/defaults/svg.twig' with {'icon': 'chevron-down', 'class': selector ~ '__icon' } %}
            <ul class="{{selector}}__submenu {{item.classes | join(' ')}}">
              {% for subItem in item.children %}
              <li class="{{selector}}__submenu-item">
                <a class="{{selector}}__submenu-link {{subItem.classes | join(' ')}}"  href="{{ subItem.link }}" title="{{ subItem.title }}">
                  <div class="{{selector}}__submenu-image-wrapper">
                    {% if subItem.thumbnail %}
                      {% set menuImage = {
                          src: TimberImage(subItem.thumbnail).src|tojpg|resize(80, 50)|retina(1),
                          srcset: [
                              TimberImage(subItem.thumbnail).src|tojpg|resize(80, 50)|retina(1) ~ " 1x",
                              TimberImage(subItem.thumbnail).src|tojpg|resize(80, 50)|retina(2) ~ " 2x"
                          ],
                          placeholder: TimberImage(subItem.thumbnail).src|tojpg|resize(40, 25),
                          classes: selector ~ "__submenu-image"
                      } %}
                      {% include 'partials/defaults/image.twig' with { 'image': menuImage } %}

                    {% endif %}
                  </div>
                  {{ subItem.title }}
                </a>
              </li>
              {% endfor %}
            </ul>
          {% endif %}
        </li>
      {% endfor %}
    </ul>
  </nav>
{% endif %}